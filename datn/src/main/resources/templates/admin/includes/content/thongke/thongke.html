<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{admin/layout.html}">
<head>
    <meta charset="UTF-8">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tom-select/dist/css/tom-select.min.css">
    <script src="https://cdn.jsdelivr.net/npm/tom-select"></script>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@10">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@10.16.0/dist/sweetalert2.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10.16.0/dist/sweetalert2.min.js"></script>

    <title>Trang Thống Kê</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f8f9fa;
        }
        .container {
            padding: 20px;
        }
        .header {
            display: flex;
            justify-content: space-around;
            margin-bottom: 20px;
        }
        .card {
            background: #fff;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            width: 22%;
            text-align: center;
            transition: transform 0.3s;
        }
        .card:hover {
            transform: translateY(-10px);
        }
        .card h2 {
            margin: 0;
            font-size: 3em;
            color: #007bff;
        }
        .card p {
            margin: 0;
            color: #6c757d;
        }
        .positive-change {
            color: green;
        }
        .negative-change {
            color: red;
        }
        .content {
            display: flex;
            justify-content: space-between;
        }
        .chart, .orders {
            background: #fff;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            width: 48%;
            height: 400px;
            overflow-y: auto;
        }
        .orders ul {
            list-style: none;
            padding: 0;
        }
        .orders li {
            padding: 10px;
            border-bottom: 1px solid #dee2e6;
        }
        .orders li:last-child {
            border-bottom: none;
        }
        .pagination {
            display: flex;
            justify-content: center;
            margin-top: 20px;
        }
        .pagination button {
            background: #007bff;
            color: #fff;
            border: none;
            padding: 10px 20px;
            margin: 0 5px;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s;
        }
        .pagination button:hover {
            background: #0056b3;
        }
        .div-tong {
            width: 100%;
            margin-top: 25px;
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            position: relative;
        }
        .tabs {
            display: flex;
            justify-content: flex-end;
            padding: 10px 20px;
        }
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            background-color: #fff;
            color : #007bff;
            border: 1px solid #dddddd;
            border-radius: 5px 5px 0 0;
            margin-left: 10px;
            transition: background-color 0.3s ease;
        }
        .tab.active {
            color : #fff;
            background-color: #007bff;
            border: 1px solid #007bff;
            border-bottom: none;
        }
        .tab:hover {
            background-color: #0056b3;
        }
        .tab-content {
            display: none;
            padding: 20px;
            border-top: 1px solid #007bff;
        }
        .tab-content.active {
            display: block;
        }
        h2 {
            color: #333;
        }
        p {
            color: #666;
        }
        .input-container {
            margin-top: 20px;
            display: flex;
            justify-content: space-around;
            align-items: center;
        }
        .input-container label {
            margin-right: 10px;
        }
        .input-container select, .input-container input {
            padding: 5px;
            border: 1px solid #ccc;
            border-radius: 5px;
            outline: none;
            transition: border-color 0.3s;
        }
        .input-container select:focus, .input-container input:focus {
            border-color: #4CAF50;
        }
        .input-container button {
            padding: 5px 15px;
            border: none;
            border-radius: 5px;
            background-color: #4CAF50;
            color: white;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .input-container button:hover {
            background-color: #45a049;
        }
    </style>
</head>
<body>
<div class="container" layout:fragment="admincontent">
    <div class="header">
        <div class="card">
            <h2 id="customers-today">0</h2>
            <p>Khách hàng hôm nay</p>
            <p id="customers-change-today">+0% so với hôm qua</p>
        </div>
        <div class="card">
            <h2 id="orders-today">0</h2>
            <p>Đơn hàng hôm nay</p>
            <p id="orders-change-today">+0% so với hôm qua</p>
        </div>
        <div class="card">
            <h2 id="customers-month">0</h2>
            <p>Khách hàng tháng này</p>
            <p id="customers-change-month">+0% so với tháng trước</p>
        </div>
        <div class="card">
            <h2 id="orders-month">0</h2>
            <p>Đơn hàng tháng này</p>
            <p id="orders-change-month">+0% so với tháng trước</p>
        </div>
    </div>
    <div class="content">
        <div class="chart">
            <canvas id="orderChart"></canvas>
        </div>
        <div class="orders">
            <h3>Danh sách đơn hàng hôm nay</h3>
            <ul id="orderList">
                <!-- Orders will be inserted here -->
            </ul>
            <div class="pagination">
                <button id="prevPage">Trước</button>
                <button id="nextPage">Sau</button>
            </div>
        </div>
    </div>

    <div class="div-tong">
        <div class="tabs">
            <div class="tab active" onclick="openTab(event, 'tab1')">Sản phẩm</div>
            <div class="tab" onclick="openTab(event, 'tab2')">Đơn hàng</div>
        </div>
        <div id="tab1" class="tab-content active">
            <div class="chart-container" id="chart1">
                <canvas id="myChart1"></canvas>
                <div class="input-container">
                    <label for="product1">Thương hiệu:</label>
                    <select id="product1">
                    </select>
                    <label for="product2">Sản phẩm:</label>
                    <select id="product2">
                    </select>
                    <label for="product3">Màu sắc:</label>
                    <select id="product3">
                    </select>
                    <button id="updateChart1">Thống kê</button>
                </div>
            </div>
        </div>
        <div id="tab2" class="tab-content">
            <div class="chart-container" id="chart2">
                <canvas id="myChart2"></canvas>
                <div class="input-container">
                    <label for="startMonth">Tháng bắt đầu:</label>
                    <input type="number" id="startMonth" min="1" max="12" value="1">
                    <label for="endMonth">Tháng kết thúc:</label>
                    <input type="number" id="endMonth" min="1" max="12" value="12">
                    <button id="updateChart2">Chọn</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            const stats = {
                customersToday: 0,
                customersYesterday: 0,
                ordersToday: 0,
                ordersYesterday: 0,
                customersThisMonth: 0,
                customersLastMonth: 0,
                ordersThisMonth: 0,
                ordersLastMonth: 0
            };

            const apiEndpoints = {
                customersToday: '/admin/api/thong-ke/countKhachHangToday?trangThai=6',
                customersYesterday: '/admin/api/thong-ke/countKhachHangYesterday?trangThai=6',
                ordersToday: '/admin/api/thong-ke/countHoaDonToday?trangThai=6',
                ordersYesterday: '/admin/api/thong-ke/countHoaDonYesterday?trangThai=6',
                customersThisMonth: '/admin/api/thong-ke/countKhachHangThisMonth?trangThai=6',
                customersLastMonth: '/admin/api/thong-ke/countKhachHangLastMonth?trangThai=6',
                ordersThisMonth: '/admin/api/thong-ke/countHoaDonThisMonth?trangThai=6',
                ordersLastMonth: '/admin/api/thong-ke/countHoaDonLastMonth?trangThai=6',
                ordersCurrentWeek: '/admin/api/thong-ke/countHoaDonForCurrentWeek?trangThai=6',
                ordersTodayList: '/admin/api/thong-ke/today',
                apiEndpoint: '/admin/api/thong-ke/listThuongHieu',
                listSanPhamByThuongHieu: '/admin/api/thong-ke/listSanPhamByThuongHieu?id=',
                listMauSacBySanPham: '/admin/api/thong-ke/listMauSacBySanPham?id='
            };

            let orders = []; // Khởi tạo mảng rỗng để lưu dữ liệu đơn hàng
            const itemsPerPage = 5;
            let currentPage = 1;

            async function fetchStats() {
                for (const key in apiEndpoints) {
                    if (apiEndpoints.hasOwnProperty(key)) {
                        try {
                            const response = await fetch(apiEndpoints[key]);
                            const result = await response.json();
                            if (key === 'ordersTodayList') {
                                orders = result; // Cập nhật dữ liệu đơn hàng từ API
                            } else {
                                stats[key] = result;
                            }
                            console.log(`API ${key} đã được gọi: ${apiEndpoints[key]}`);
                            console.log(`Kết quả:`, result);
                        } catch (error) {
                            console.error(`Error fetching ${key}:`, error);
                        }
                    }
                }
                updateStats();
                setupChart();
                renderOrderList(); // Hiển thị danh sách đơn hàng sau khi lấy dữ liệu
            }

            function calculatePercentageChange(newVal, oldVal) {
                if (oldVal === 0) {
                    return newVal > 0 ? '100' : '0';
                }
                return ((newVal - oldVal) / oldVal * 100).toFixed(2);
            }

            function updateStats() {
                const customersYesterday = stats.customersYesterday || 1;
                const ordersYesterday = stats.ordersYesterday || 1;
                const customersLastMonth = stats.customersLastMonth || 1;
                const ordersLastMonth = stats.ordersLastMonth || 1;

                const customersTodayChange = ((stats.customersToday - customersYesterday) / customersYesterday * 100).toFixed(2);
                const ordersTodayChange = ((stats.ordersToday - ordersYesterday) / ordersYesterday * 100).toFixed(2);
                const customersMonthChange = ((stats.customersThisMonth - customersLastMonth) / customersLastMonth * 100).toFixed(2);
                const ordersMonthChange = ((stats.ordersThisMonth - ordersLastMonth) / ordersLastMonth * 100).toFixed(2);

                document.getElementById("customers-today").innerText = stats.customersToday;
                document.getElementById("customers-change-today").innerText = `${customersTodayChange}% so với hôm qua`;
                document.getElementById("customers-change-today").className = customersTodayChange >= 0 ? 'positive-change' : 'negative-change';

                document.getElementById("orders-today").innerText = stats.ordersToday;
                document.getElementById("orders-change-today").innerText = `${ordersTodayChange}% so với hôm qua`;
                document.getElementById("orders-change-today").className = ordersTodayChange >= 0 ? 'positive-change' : 'negative-change';

                document.getElementById("customers-month").innerText = stats.customersThisMonth;
                document.getElementById("customers-change-month").innerText = `${customersMonthChange}% so với tháng trước`;
                document.getElementById("customers-change-month").className = customersMonthChange >= 0 ? 'positive-change' : 'negative-change';

                document.getElementById("orders-month").innerText = stats.ordersThisMonth;
                document.getElementById("orders-change-month").innerText = `${ordersMonthChange}% so với tháng trước`;
                document.getElementById("orders-change-month").className = ordersMonthChange >= 0 ? 'positive-change' : 'negative-change';
            }

            // api lấy ra combobox

            async function updateProductSelects() {
                try {
                    const response = await fetch(apiEndpoints.apiEndpoint);
                    const thuongHieus = await response.json();

                    updateSelectThuongHieu('product1', thuongHieus);
                } catch (error) {
                    console.error(`Error fetching data:`, error);
                }
            }

            async function fetchSanPhamByThuongHieu(id) {
                try {
                    const response = await fetch(apiEndpoints.listSanPhamByThuongHieu + id);
                    const sanPhams = await response.json();
                    updateSelectSanPham('product2', sanPhams);
                } catch (error) {
                    console.error(`Error fetching products by brand:`, error);
                }
            }

            async function fetchMauSacBySanPham(id) {
                try {
                    const response = await fetch(apiEndpoints.listMauSacBySanPham + id);
                    const mauSacs = await response.json();
                    updateSelectMauSac('product3', mauSacs);
                } catch (error) {
                    console.error(`Error fetching products by brand:`, error);
                }
            }

            //// hiệu ứng click combobox

            function handleProductSelectChange(event) {
                const selectedValue = event.target.value;
                if (selectedValue) {
                    fetchSanPhamByThuongHieu(selectedValue);
                }
            }

            document.getElementById("product1").addEventListener("change", handleProductSelectChange);

            function handleMauSacSelectChange(event) {
                const selectedValue = event.target.value;
                if (selectedValue) {
                    fetchMauSacBySanPham(selectedValue);
                }
            }

            document.getElementById("product2").addEventListener("change", handleMauSacSelectChange);

            // hiển thị lên combobox
            function updateSelectThuongHieu(selectId, thuongHieus) {
                const selectElement = document.getElementById(selectId);
                selectElement.innerHTML = "";

                const defaultOption = document.createElement("option");
                defaultOption.value = 0;
                defaultOption.textContent = "Chọn";
                selectElement.appendChild(defaultOption);

                thuongHieus.forEach(thuongHieu => {
                    const option = document.createElement("option");
                    option.value = thuongHieu.thuongHieuId;
                    option.textContent = thuongHieu.ten;
                    selectElement.appendChild(option);
                });
            }

            function updateSelectSanPham(selectId, sanPhams) {
                const selectElement = document.getElementById(selectId);
                selectElement.innerHTML = "";

                const defaultOption = document.createElement("option");
                defaultOption.value = 0;
                defaultOption.textContent = "Chọn";
                selectElement.appendChild(defaultOption);

                sanPhams.forEach(sanPham => {
                    const option = document.createElement("option");
                    option.value = sanPham.sanPhamId;
                    option.textContent = sanPham.ten;
                    selectElement.appendChild(option);
                });
            }

            function updateSelectMauSac(selectId, mauSacs) {
                const selectElement = document.getElementById(selectId);
                selectElement.innerHTML = "";

                const defaultOption = document.createElement("option");
                defaultOption.value = 0;
                defaultOption.textContent = "Chọn";
                selectElement.appendChild(defaultOption);

                mauSacs.forEach(mauSac => {
                    const option = document.createElement("option");
                    option.value = mauSac.mauSacId;
                    option.textContent = mauSac.ten;
                    selectElement.appendChild(option);
                });
            }

            document.getElementById("updateChart1").addEventListener("click", handleUpdateChart1);
            document.getElementById("updateChart2").addEventListener("click", handleUpdateChart2);

            /////// thống kê

            async function handleUpdateChart1() {
                const thuongHieuId = document.getElementById("product1").value;
                const sanPhamId = document.getElementById("product2").value;
                const mauSacId = document.getElementById("product3").value;

                if (thuongHieuId === "0" || sanPhamId === "0" || mauSacId === "0") {
                    Swal.fire({
                        position: 'center',
                        toast: false,
                        showConfirmButton: false,
                        timer: 2000,
                        text: 'Vui lòng chọn đầy đủ thông tin!',
                        icon: 'warning',
                    });
                    return;
                }

                try {
                    const nameSpResponse = await fetch(`/admin/api/thong-ke/nameSpOfSanPhamChiTiet?idSp=${sanPhamId}&idMs=${mauSacId}`);
                    const nameSpData = await nameSpResponse.json();

                    const giaBanOfSanPhamChiTietResponse = await fetch(`/admin/api/thong-ke/giaBanOfSanPhamChiTiet?idSp=${sanPhamId}&idMs=${mauSacId}`);
                    const giaBanOfSanPhamChiTietData = await giaBanOfSanPhamChiTietResponse.json();

                    const countSoLuongTonResponse = await fetch(`/admin/api/thong-ke/countSoLuongTonOfSanPhamChiTiet?idSp=${sanPhamId}&idMs=${mauSacId}`);
                    const countSoLuongTonData = await countSoLuongTonResponse.json();

                    const countSoLuongBanResponse = await fetch(`/admin/api/thong-ke/countSoLuongBanOfSanPhamChiTiet?idSp=${sanPhamId}&idMs=${mauSacId}`);
                    const countSoLuongBanData = await countSoLuongBanResponse.json();

                    updateChart1(nameSpData, giaBanOfSanPhamChiTietData, countSoLuongTonData, countSoLuongBanData);
                } catch (error) {
                    console.error(`Error fetching data:`, error);
                }
            }

            async function handleUpdateChart2(){
                var startMonth = parseInt(document.getElementById('startMonth').value);
                var endMonth = parseInt(document.getElementById('endMonth').value);

                if (isNaN(startMonth) || isNaN(endMonth)) {
                    Swal.fire({
                        position: 'center',
                        toast: false,
                        showConfirmButton: false,
                        timer: 2000,
                        text: 'Vui lòng nhập giá trị cho cả hai tháng!',
                        icon: 'warning',
                    });
                    return;
                }
                if (startMonth < 1 || startMonth > 12 || endMonth < 1 || endMonth > 12) {
                    Swal.fire({
                        position: 'center',
                        toast: false,
                        showConfirmButton: false,
                        timer: 2000,
                        text: 'Giá trị tháng phải nằm trong khoảng từ 1 đến 12!',
                        icon: 'warning',
                    });
                    return;
                }
                if (startMonth >= endMonth) {
                    Swal.fire({
                        position: 'center',
                        toast: false,
                        showConfirmButton: false,
                        timer: 2000,
                        text: 'Tháng bắt đầu phải nhỏ hơn tháng kết thúc!',
                        icon: 'warning',
                    });
                    return;
                }

                try {
                    const nameSpResponse = await fetch(`/admin/api/thong-ke/getNumbersInRange?start=${startMonth}&end=${endMonth}`);
                    const nameSpData = await nameSpResponse.json();

                    const countsDonHangByMonthHoanThanhResponse = await fetch(`/admin/api/thong-ke/countsDonHangByMonth?start=${startMonth}&end=${endMonth}&trangThai=6`);
                    const countsDonHangByMonthHoanThanhData = await countsDonHangByMonthHoanThanhResponse.json();

                    const countsDonHangByMonthHuyResponse = await fetch(`/admin/api/thong-ke/countsDonHangByMonth?start=${startMonth}&end=${endMonth}&trangThai=7`);
                    const countsDonHangByMonthHuyData = await countsDonHangByMonthHuyResponse.json();

                    const sumDonHangByMonthHoanThanhResponse = await fetch(`/admin/api/thong-ke/sumDonHangByMonth?start=${startMonth}&end=${endMonth}&trangThai=6`);
                    const sumDonHangByMonthHoanThanhData = await sumDonHangByMonthHoanThanhResponse.json();

                    const sumDonHangByMonthHuyResponse = await fetch(`/admin/api/thong-ke/sumDonHangByMonth?start=${startMonth}&end=${endMonth}&trangThai=7`);
                    const sumDonHangByMonthHuyData = await sumDonHangByMonthHuyResponse.json();

                    updateChart2(nameSpData, countsDonHangByMonthHoanThanhData, countsDonHangByMonthHuyData, sumDonHangByMonthHoanThanhData, sumDonHangByMonthHuyData);
                } catch (error) {
                    console.error(`Error fetching data:`, error);
                }
            }

            /////////////

            function renderOrderList() {
                const start = (currentPage - 1) * itemsPerPage;
                const end = start + itemsPerPage;
                const orderList = document.getElementById("orderList");
                orderList.innerHTML = "";

                for (let i = start; i < end && i < orders.length; i++) {
                    const listItem = document.createElement("li");
                    listItem.innerText = orders[i];
                    orderList.appendChild(listItem);
                }
            }

            document.getElementById("prevPage").addEventListener("click", function() {
                if (currentPage > 1) {
                    currentPage--;
                    renderOrderList();
                }
            });

            document.getElementById("nextPage").addEventListener("click", function() {
                if (currentPage * itemsPerPage < orders.length) {
                    currentPage++;
                    renderOrderList();
                }
            });

            async function setupChart() {
                try {
                    const response = await fetch(apiEndpoints.ordersCurrentWeek);
                    const weeklyOrders = await response.json();

                    const ctx = document.getElementById("orderChart").getContext("2d");
                    new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: ["Thứ 2", "Thứ 3", "Thứ 4", "Thứ 5", "Thứ 6", "Thứ 7", "Chủ Nhật"],
                            datasets: [{
                                label: 'Đơn hàng hoàn thành',
                                data: weeklyOrders,
                                backgroundColor: 'rgba(54, 162, 235, 0.2)',
                                borderColor: 'rgba(54, 162, 235, 1)',
                                borderWidth: 1
                            }]
                        },
                        options: {
                            scales: {
                                y: {
                                    beginAtZero: true
                                }
                            }
                        }
                    });
                } catch (error) {
                    console.error(`Error setting up chart:`, error);
                }
            }

            let myChart1;

            function updateChart1(nameSpData, giaBanOfSanPhamChiTietData, countSoLuongTonData, countSoLuongBanData) {
                var ctx1 = document.getElementById('myChart1').getContext('2d');

                if (myChart1) {
                    myChart1.destroy();
                }
                myChart1 = new Chart(ctx1, {
                    type: 'bar',
                    data: {
                        labels: nameSpData,
                        datasets: [{
                            label: 'Đơn giá',
                            type: 'bar',
                            data: giaBanOfSanPhamChiTietData,
                            backgroundColor: 'rgba(54, 162, 235, 0.2)',
                            borderColor: 'rgba(54, 162, 235, 1)',
                            borderWidth: 1,
                            yAxisID: 'y-axis-1'
                        }, {
                            label: 'Số sẩn phẩm tồn',
                            type: 'line',
                            data: countSoLuongTonData,
                            backgroundColor: 'rgba(75, 192, 192, 0.2)',
                            borderColor: 'rgba(75, 192, 192, 1)',
                            borderWidth: 1,
                            fill: false,
                            yAxisID: 'y-axis-2'
                        }, {
                            label: 'Số sản phẩm đã bán',
                            type: 'line',
                            data: countSoLuongBanData,
                            backgroundColor: 'rgba(255, 99, 132, 0.2)',
                            borderColor: 'rgba(255, 99, 132, 1)',
                            borderWidth: 1,
                            fill: false,
                            yAxisID: 'y-axis-2'
                        }]
                    },
                    options: {
                        scales: {
                            yAxes: [{
                                id: 'y-axis-1',
                                type: 'linear',
                                position: 'left',
                                ticks: {
                                    beginAtZero: true
                                }
                            }, {
                                id: 'y-axis-2',
                                type: 'linear',
                                position: 'right',
                                ticks: {
                                    beginAtZero: true
                                },
                                gridLines: {
                                    drawOnChartArea: false
                                }
                            }]
                        }
                    }
                });
            }

            let myChart2;

            function updateChart2(nameSpData, countsDonHangByMonthHoanThanhData, countsDonHangByMonthHuyData, sumDonHangByMonthHoanThanhData, sumDonHangByMonthHuyData) {
                var ctx2 = document.getElementById('myChart2').getContext('2d');

                // Nếu biểu đồ đã được tạo, phá hủy biểu đồ cũ
                if (myChart2) {
                    myChart2.destroy();
                }

                // Tạo biểu đồ mới
                myChart2 = new Chart(ctx2, {
                    type: 'bar',
                    data: {
                        labels: nameSpData,
                        datasets: [{
                            type: 'bar',
                            label: 'Số đơn hoàn thành',
                            data: countsDonHangByMonthHoanThanhData,
                            backgroundColor: 'rgba(54, 162, 235, 0.2)',
                            borderColor: 'rgba(54, 162, 235, 1)',
                            borderWidth: 1,
                            yAxisID: 'y-axis-1'
                        }, {
                            type: 'bar',
                            label: 'Số đơn hủy',
                            data: countsDonHangByMonthHuyData,
                            backgroundColor: 'rgba(255, 99, 132, 0.2)',
                            borderColor: 'rgba(255, 99, 132, 1)',
                            borderWidth: 1,
                            yAxisID: 'y-axis-1'
                        }, {
                            type: 'line',
                            label: 'Tổng tiền hoàn thành',
                            data: sumDonHangByMonthHoanThanhData,
                            borderColor: 'rgba(75, 192, 192, 1)',
                            backgroundColor: 'rgba(75, 192, 192, 0.2)',
                            fill: true,
                            yAxisID: 'y-axis-2'
                        }, {
                            type: 'line',
                            label: 'Tổng tiền hủy',
                            data: sumDonHangByMonthHuyData,
                            borderColor: 'rgba(255, 159, 64, 1)',
                            backgroundColor: 'rgba(255, 159, 64, 0.2)',
                            fill: true,
                            yAxisID: 'y-axis-2'
                        }]
                    },
                    options: {
                        scales: {
                            yAxes: [{
                                id: 'y-axis-1',
                                type: 'linear',
                                position: 'left',
                                ticks: {
                                    beginAtZero: true
                                }
                            }, {
                                id: 'y-axis-2',
                                type: 'linear',
                                position: 'right',
                                ticks: {
                                    beginAtZero: true
                                },
                                gridLines: {
                                    drawOnChartArea: false
                                }
                            }]
                        }
                    }
                });
            }


            fetchStats();
            updateProductSelects();
        });
    </script>

    <script>
        function openTab(event, tabId) {
            var i, tabcontent, tablinks;
            tabcontent = document.getElementsByClassName("tab-content");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].classList.remove("active");
            }
            tablinks = document.getElementsByClassName("tab");
            for (i = 0; i < tablinks.length; i++) {
                tablinks[i].classList.remove("active");
            }
            document.getElementById(tabId).classList.add("active");
            event.currentTarget.classList.add("active");
        }
    </script>

</div>

</body>
</html>
